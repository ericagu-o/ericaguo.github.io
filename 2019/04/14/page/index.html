<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>关于日志的时区问题 | The Road</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="问题docker中的日志因先导入文件服务器后，再通过Filebeat传入ES。发现日志时间差8小时。初步查询后是因为docker内时区为UCT，文件服务器时区为PRC，导致传入了UCT的时间，PRC的时区。 解决方法一：DockerFile中修改容器时区 1RUN /bin/cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;amp;&amp;amp;">
<meta name="keywords" content="Kibana,日志,issue,工作">
<meta property="og:type" content="article">
<meta property="og:title" content="关于日志的时区问题">
<meta property="og:url" content="http://yoursite.com/2019/04/14/page/index.html">
<meta property="og:site_name" content="The Road">
<meta property="og:description" content="问题docker中的日志因先导入文件服务器后，再通过Filebeat传入ES。发现日志时间差8小时。初步查询后是因为docker内时区为UCT，文件服务器时区为PRC，导致传入了UCT的时间，PRC的时区。 解决方法一：DockerFile中修改容器时区 1RUN /bin/cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;amp;&amp;amp;">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://thumbnail10.baidupcs.com/thumbnail/739e14b0871421d185645f76abef8225?fid=1409794109-250528-658621813403311&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-%2fwZdWvyUBnt%2fKuuSz5AsKq2yZ5I%3d&expires=8h&chkbd=0&chkv=0&dp-logid=2404523620559215769&dp-callid=0&time=1555228800&size=c10000_u10000&quality=90&vuk=1409794109&ft=image">
<meta property="og:image" content="https://thumbnail10.baidupcs.com/thumbnail/395722ee924a3c4cdef07e0e19aa38f6?fid=1409794109-250528-580700258856185&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-2jHP1OUeEe4EDfZSR0XyJeUjCVQ%3d&expires=8h&chkbd=0&chkv=0&dp-logid=2404523620559215769&dp-callid=0&time=1555228800&size=c10000_u10000&quality=90&vuk=1409794109&ft=image">
<meta property="og:image" content="https://thumbnail10.baidupcs.com/thumbnail/ef413cf9fa70e8de6998a8868973016a?fid=1409794109-250528-569092507106343&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-CERKjJ05vcHYB87VFIZP3wNsBWY%3d&expires=8h&chkbd=0&chkv=0&dp-logid=2404523620559215769&dp-callid=0&time=1555228800&size=c10000_u10000&quality=90&vuk=1409794109&ft=image">
<meta property="og:updated_time" content="2019-04-14T09:45:34.755Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="关于日志的时区问题">
<meta name="twitter:description" content="问题docker中的日志因先导入文件服务器后，再通过Filebeat传入ES。发现日志时间差8小时。初步查询后是因为docker内时区为UCT，文件服务器时区为PRC，导致传入了UCT的时间，PRC的时区。 解决方法一：DockerFile中修改容器时区 1RUN /bin/cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;amp;&amp;amp;">
<meta name="twitter:image" content="https://thumbnail10.baidupcs.com/thumbnail/739e14b0871421d185645f76abef8225?fid=1409794109-250528-658621813403311&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-%2fwZdWvyUBnt%2fKuuSz5AsKq2yZ5I%3d&expires=8h&chkbd=0&chkv=0&dp-logid=2404523620559215769&dp-callid=0&time=1555228800&size=c10000_u10000&quality=90&vuk=1409794109&ft=image">
  
    <link rel="alternate" href="/atom.xml" title="The Road" type="application/atom+xml">
  
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" integrity="sha384-XdYbMnZ/QjLh6iI4ogqCTaIjrFk87ip+ekIjefZch0Y+PvJ8CDYtEs1ipDmPorQ+" crossorigin="anonymous">

  <link rel="stylesheet" href="/css/styles.css">
  

</head>
</html>
<body>
  <nav class="navbar navbar-inverse">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="main-menu-navbar">
      <ul class="nav navbar-nav">
        
          <li><a class href="/index.html">Home</a></li>
        
          <li><a class href="/archives/">Archives</a></li>
        
      </ul>

      <!--
      <ul class="nav navbar-nav navbar-right">
        
          <li><a href="/atom.xml" title="RSS Feed"><i class="fa fa-rss"></i></a></li>
        
      </ul>
      -->
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

  <div class="container">
    <div class="blog-header">
  <h1 class="blog-title">The Road</h1>
  
</div>

    <div class="row">
        <div class="col-sm-8 blog-main">
          <article id="post-page" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 class="article-title" itemprop="name">
      关于日志的时区问题
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2019/04/14/page/" class="article-date"><time datetime="2019-04-14T07:41:48.000Z" itemprop="datePublished">2019-04-14</time></a>
</div>

    
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Elastic-Stack/">Elastic Stack</a>
  </div>


  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>docker中的日志因先导入文件服务器后，再通过Filebeat传入ES。发现日志时间差8小时。初步查询后是因为docker内时区为UCT，文件服务器时区为PRC，导致传入了UCT的时间，PRC的时区。</p>
<h2 id="解决方法一："><a href="#解决方法一：" class="headerlink" title="解决方法一："></a>解决方法一：</h2><p>DockerFile中修改容器时区</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RUN /bin/cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; echo &apos;Asia/Shanghai&apos; &gt;/etc/timezone</span><br></pre></td></tr></table></figure>
<p><img src="https://thumbnail10.baidupcs.com/thumbnail/739e14b0871421d185645f76abef8225?fid=1409794109-250528-658621813403311&amp;rt=pr&amp;sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-%2fwZdWvyUBnt%2fKuuSz5AsKq2yZ5I%3d&amp;expires=8h&amp;chkbd=0&amp;chkv=0&amp;dp-logid=2404523620559215769&amp;dp-callid=0&amp;time=1555228800&amp;size=c10000_u10000&amp;quality=90&amp;vuk=1409794109&amp;ft=image" alt="dockerfile"></p>
<p>结果：解决问题</p>
<h2 id="解决方法二："><a href="#解决方法二：" class="headerlink" title="解决方法二："></a>解决方法二：</h2><p>在logstash的conf文件中，解析时间字段时，增加timezone字段，值可以通过filebeat传入。</p>
<p> <img src="https://thumbnail10.baidupcs.com/thumbnail/395722ee924a3c4cdef07e0e19aa38f6?fid=1409794109-250528-580700258856185&amp;rt=pr&amp;sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-2jHP1OUeEe4EDfZSR0XyJeUjCVQ%3d&amp;expires=8h&amp;chkbd=0&amp;chkv=0&amp;dp-logid=2404523620559215769&amp;dp-callid=0&amp;time=1555228800&amp;size=c10000_u10000&amp;quality=90&amp;vuk=1409794109&amp;ft=image" alt="conf文件"></p>
<p> <img src="https://thumbnail10.baidupcs.com/thumbnail/ef413cf9fa70e8de6998a8868973016a?fid=1409794109-250528-569092507106343&amp;rt=pr&amp;sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-CERKjJ05vcHYB87VFIZP3wNsBWY%3d&amp;expires=8h&amp;chkbd=0&amp;chkv=0&amp;dp-logid=2404523620559215769&amp;dp-callid=0&amp;time=1555228800&amp;size=c10000_u10000&amp;quality=90&amp;vuk=1409794109&amp;ft=image" alt="filebeat.yml"></p>
<p>timezone查询：<a href="http://joda-time.sourceforge.net/timezones.html" target="_blank" rel="noopener">http://joda-time.sourceforge.net/timezones.html</a><br>结果：解决问题</p>
<hr>
<h2 id="时区问题的解释"><a href="#时区问题的解释" class="headerlink" title="时区问题的解释"></a>时区问题的解释</h2><p>很多中国用户经常提一个问题：为什么 @timestamp 比我们早了 8 个小时？怎么修改成北京时间？<br>其实，Elasticsearch 内部，对时间类型字段，是统一采用 UTC 时间，存成 long 长整形数据的！对日志统一采用 UTC 时间存储，是国际安全/运维界的一个通识——欧美公司的服务器普遍广泛分布在多个时区里——不像中国，地域横跨五个时区却只用北京时间。<br>对于页面查看，ELK 的解决方案是在 Kibana 上，读取浏览器的当前时区，然后在页面上转换时间内容的显示。<br>所以，建议大家接受这种设定。否则，即便你用 .getLocalTime 修改，也还要面临在 Kibana 上反过去修改，以及 Elasticsearch 原有的 [“now-1h” TO “now”] 这种方便的搜索语句无法正常使用的尴尬。<br>以上，请读者自行斟酌。</p>
<p><a href="https://www.elastic.co/guide/en/logstash/current/plugins-filters-date.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/logstash/current/plugins-filters-date.html</a><br><a href="http://joda-time.sourceforge.net/timezones.html" target="_blank" rel="noopener">http://joda-time.sourceforge.net/timezones.html</a><br><a href="https://doc.yonyoucloud.com/doc/logstash-best-practice-cn/filter/date.html" target="_blank" rel="noopener">https://doc.yonyoucloud.com/doc/logstash-best-practice-cn/filter/date.html</a><br><a href="https://discuss.elastic.co/t/how-to-set-timestamp-timezone/28401/14" target="_blank" rel="noopener">https://discuss.elastic.co/t/how-to-set-timestamp-timezone/28401/14</a></p>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/14/page/" data-id="cjugrauuj000214vjbj5dev2z" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Kibana/">Kibana</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/issue/">issue</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/工作/">工作</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/日志/">日志</a></li></ul>


    </footer>
  </div>
  
    

  
</article>




        </div>
        <div class="col-sm-3 col-sm-offset-1 blog-sidebar">
          
  <div class="sidebar-module sidebar-module-inset">
  <h4>About</h4>
  <p>Etiam porta <em>sem malesuada magna</em> mollis euismod. Cras mattis consectetur purus sit amet fermentum. Aenean lacinia bibendum nulla sed consectetur.</p>

</div>


  
  <div class="sidebar-module">
    <h4>Categories</h4>
    <ul class="sidebar-module-list"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/Elastic-Stack/">Elastic Stack</a><span class="sidebar-module-list-count">1</span></li></ul>
  </div>



  
  <div class="sidebar-module">
    <h4>Tags</h4>
    <ul class="sidebar-module-list"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/Kibana/">Kibana</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/issue/">issue</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/工作/">工作</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/日志/">日志</a><span class="sidebar-module-list-count">1</span></li></ul>
  </div>



  
  <div class="sidebar-module">
    <h4>Tag Cloud</h4>
    <p class="tagcloud">
      <a href="/tags/Kibana/" style="font-size: 10px;">Kibana</a> <a href="/tags/issue/" style="font-size: 10px;">issue</a> <a href="/tags/工作/" style="font-size: 10px;">工作</a> <a href="/tags/日志/" style="font-size: 10px;">日志</a>
    </p>
  </div>


  
  <div class="sidebar-module">
    <h4>Archives</h4>
    <ul class="sidebar-module-list"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2019/04/">四月 2019</a><span class="sidebar-module-list-count">1</span></li></ul>
  </div>



  
  <div class="sidebar-module">
    <h4>Recents</h4>
    <ul class="sidebar-module-list">
      
        <li>
          <a href="/2019/04/14/page/">关于日志的时区问题</a>
        </li>
      
    </ul>
  </div>



        </div>
    </div>
  </div>
  <footer class="blog-footer">
  <div class="container">
    <div id="footer-info" class="inner">
      &copy; 2019 Erica Guo<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

  

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>



<script src="/js/script.js"></script>

</body>
</html>
